import{n as ke,e as S,s as B,b as V,l as T,c as L,d as y,m as r,p as X,i as x,o as w,J as N,C as be,L as W,M as we,j as A,k as I,X as Z,a as Ee,x as re,y as le,g as Te,A as De,G as Me}from"../chunks/scheduler.EKw-xcnK.js";import{S as Pe,i as qe,c as Ce,a as Ae,m as Ie,t as Ge,b as Ne,d as Se}from"../chunks/index.nrQb7by4.js";import{e as $,u as Ve,d as xe}from"../chunks/each.JsaE_8Dp.js";import{s as Oe}from"../chunks/spring.ohFOMQQJ.js";import{l as ee}from"../chunks/maths.K6m04wT8.js";import{s as R}from"../chunks/dom.z-RU6ZBL.js";import{g as Fe}from"../chunks/dimensions.tILrlVrF.js";import{h as Ue}from"../chunks/colors.kIcc3VL_.js";import{g as Be}from"../chunks/audio_ctx.00dK44gF.js";import{v as Le,S as j}from"../chunks/audio_helpers.nUJdtt8J.js";import{f as Xe,D as Ye}from"../chunks/notes.NhmHMgZV.js";import{F as Ke}from"../chunks/FloatingIconButton.QQQ7T88v.js";function te(s,t,e){const l=s.slice();return l[33]=t[e],l}function se(s){let t,e,l,f,i=[],k=new Map,d,a,h,b,E,o,m,_,u=$(s[4]);const g=c=>c[33].id;for(let c=0;c<u.length;c+=1){let p=te(s,u,c),v=g(p);k.set(v,i[c]=ie(v,p))}return{c(){t=A("svg"),e=A("image"),l=A("defs"),f=A("mask");for(let c=0;c<i.length;c+=1)i[c].c();d=A("filter"),a=A("feGaussianBlur"),h=A("circle"),o=A("circle"),this.h()},l(c){t=I(c,"svg",{class:!0});var p=T(t);e=I(p,"image",{"xlink:href":!0,width:!0,height:!0,mask:!0}),T(e).forEach(y),l=I(p,"defs",{});var v=T(l);f=I(v,"mask",{id:!0});var O=T(f);for(let M=0;M<i.length;M+=1)i[M].l(O);O.forEach(y),v.forEach(y),d=I(p,"filter",{id:!0,height:!0,width:!0,y:!0,x:!0});var F=T(d);a=I(F,"feGaussianBlur",{in:!0,stdDeviation:!0}),T(a).forEach(y),F.forEach(y),h=I(p,"circle",{class:!0,cx:!0,cy:!0,r:!0,filter:!0}),T(h).forEach(y),o=I(p,"circle",{class:!0,cx:!0,cy:!0,r:!0}),T(o).forEach(y),p.forEach(y),this.h()},h(){Z(e,"xlink:href",s[3]),r(e,"width",s[0]),r(e,"height",s[1]),r(e,"mask","url(#linePaths)"),r(f,"id","linePaths"),r(a,"in","SourceGraphic"),r(a,"stdDeviation","15"),r(d,"id","blurOuter"),r(d,"height","300%"),r(d,"width","300%"),r(d,"y","-50%"),r(d,"x","-50%"),r(h,"class","outer svelte-1yrfxd2"),r(h,"cx",b=s[6].x),r(h,"cy",E=s[6].y),r(h,"r",30),r(h,"filter","url(#blurOuter)"),r(o,"class","inner svelte-1yrfxd2"),r(o,"cx",m=s[6].x),r(o,"cy",_=s[6].y),r(o,"r",2),r(t,"class","drawing svelte-1yrfxd2")},m(c,p){x(c,t,p),w(t,e),w(t,l),w(l,f);for(let v=0;v<i.length;v+=1)i[v]&&i[v].m(f,null);w(t,d),w(d,a),w(t,h),w(t,o)},p(c,p){p[0]&8&&Z(e,"xlink:href",c[3]),p[0]&1&&r(e,"width",c[0]),p[0]&2&&r(e,"height",c[1]),p[0]&16&&(u=$(c[4]),i=Ve(i,p,g,1,c,u,k,f,xe,ie,null,te)),p[0]&64&&b!==(b=c[6].x)&&r(h,"cx",b),p[0]&64&&E!==(E=c[6].y)&&r(h,"cy",E),p[0]&64&&m!==(m=c[6].x)&&r(o,"cx",m),p[0]&64&&_!==(_=c[6].y)&&r(o,"cy",_)},d(c){c&&y(t);for(let p=0;p<i.length;p+=1)i[p].d()}}}function ie(s,t){let e,l;return{key:s,first:null,c(){e=A("polyline"),this.h()},l(f){e=I(f,"polyline",{points:!0,stroke:!0,"stroke-width":!0,fill:!0}),T(e).forEach(y),this.h()},h(){r(e,"points",l=t[33].points),r(e,"stroke","white"),r(e,"stroke-width","5"),r(e,"fill","none"),this.first=e},m(f,i){x(f,e,i)},p(f,i){t=f,i[0]&16&&l!==(l=t[33].points)&&r(e,"points",l)},d(f){f&&y(e)}}}function ne(s){let t;return{c(){t=S("canvas"),this.h()},l(e){t=V(e,"CANVAS",{class:!0}),T(t).forEach(y),this.h()},h(){r(t,"class","bg-canvas svelte-1yrfxd2")},m(e,l){x(e,t,l),s[18](t)},p:Ee,d(e){e&&y(t),s[18](null)}}}function oe(s){let t,e,l,f,i="hz";return{c(){t=S("div"),e=S("div"),l=re(s[5]),f=S("span"),f.textContent=i,this.h()},l(k){t=V(k,"DIV",{class:!0});var d=T(t);e=V(d,"DIV",{});var a=T(e);l=le(a,s[5]),f=V(a,"SPAN",{class:!0,"data-svelte-h":!0}),Te(f)!=="svelte-1ewdw3h"&&(f.textContent=i),a.forEach(y),d.forEach(y),this.h()},h(){r(f,"class","unit svelte-1yrfxd2"),r(t,"class","freq idle_fade svelte-1yrfxd2")},m(k,d){x(k,t,d),w(t,e),w(e,l),w(e,f)},p(k,d){d[0]&32&&De(l,k[5])},d(k){k&&y(t)}}}function Re(s){let t;return{c(){t=re("↻")},l(e){t=le(e,"↻")},m(e,l){x(e,t,l)},d(e){e&&y(t)}}}function je(s){let t,e,l,f,i,k,d,a,h,b,E,o=s[3]&&se(s),m=s[0]!==void 0&&ne(s),_=s[5]&&oe(s);return a=new Ke({props:{label:"reset",$$slots:{default:[Re]},$$scope:{ctx:s}}}),a.$on("click",s[12]),{c(){t=S("div"),o&&o.c(),e=B(),m&&m.c(),l=B(),_&&_.c(),f=B(),i=S("div"),k=B(),d=S("div"),Ce(a.$$.fragment),this.h()},l(u){t=V(u,"DIV",{class:!0,style:!0});var g=T(t);o&&o.l(g),e=L(g),m&&m.l(g),l=L(g),_&&_.l(g),f=L(g),i=V(g,"DIV",{role:!0,class:!0}),T(i).forEach(y),k=L(g),d=V(g,"DIV",{class:!0});var c=T(d);Ae(a.$$.fragment,c),c.forEach(y),g.forEach(y),this.h()},h(){r(i,"role","none"),r(i,"class","interaction-surface svelte-1yrfxd2"),r(d,"class","controls idle_fade svelte-1yrfxd2"),r(t,"class","paint-freqs svelte-1yrfxd2"),X(t,"width",s[0]+"px"),X(t,"height",s[1]+"px")},m(u,g){x(u,t,g),o&&o.m(t,null),w(t,e),m&&m.m(t,null),w(t,l),_&&_.m(t,null),w(t,f),w(t,i),w(t,k),w(t,d),Ie(a,d,null),h=!0,b||(E=[N(i,"mousedown",s[9]),N(i,"mouseup",s[10]),N(i,"mouseleave",s[10]),N(i,"mousemove",s[11]),N(i,"touchstart",s[9]),N(i,"touchend",s[10]),N(i,"touchcancel",s[10]),N(i,"touchmove",s[11])],b=!0)},p(u,g){u[3]?o?o.p(u,g):(o=se(u),o.c(),o.m(t,e)):o&&(o.d(1),o=null),u[0]!==void 0?m?m.p(u,g):(m=ne(u),m.c(),m.m(t,l)):m&&(m.d(1),m=null),u[5]?_?_.p(u,g):(_=oe(u),_.c(),_.m(t,f)):_&&(_.d(1),_=null);const c={};g[1]&32&&(c.$$scope={dirty:g,ctx:u}),a.$set(c),(!h||g[0]&1)&&X(t,"width",u[0]+"px"),(!h||g[0]&2)&&X(t,"height",u[1]+"px")},i(u){h||(Ge(a.$$.fragment,u),h=!0)},o(u){Ne(a.$$.fragment,u),h=!1},d(u){u&&y(t),o&&o.d(),m&&m.d(),_&&_.d(),Se(a),b=!1,be(E)}}}const ze=.35,He=20,Je=6e3,Qe=.5,We=1.5;function Ze(s,t,e){let l,f,i,k;const d=Fe();W(s,d,n=>e(17,i=n));let a=i.width,h=i.height,b=-300,E=-300,o,m,_,u;const g=Array.from({length:12},(n,q)=>Ue(q/12,.3,.5)),c=()=>{_&&_.width===a&&_.height===h||(o.width!==a&&e(2,o.width=a,o),o.height!==h&&e(2,o.height=h,o),m||(m=o.getContext("2d")),m.clearRect(0,0,a,h),_=m.createImageData(a,h),p(_,m))},p=(n,q)=>{const{data:C}=n;for(let P=0;P<C.length;P+=4){const U=P/4,K=U%a,me=Math.floor(U/a),_e=H(K,me,a,h),pe=Xe(_e,Ye)%12,[ge,ve,ye]=g[pe];C[P]=ge,C[P+1]=ve,C[P+2]=ye,C[P+3]=255}q.putImageData(n,0,0),e(3,u=o.toDataURL())};let v=[{id:0,points:""}];const O=()=>({id:v[v.length-1].id+1,points:""}),F=(n,q)=>{const C=` ${n},${q}`,P=v[v.length-1];P.points?P.points+=C:P.points=`${n-3},${q-3}${C}`,e(4,v=v.slice())},M=Be(),Y=Oe({x:b,y:E},{stiffness:.08,damping:.32});W(s,Y,n=>e(6,k=n));let D,G;const ae=()=>{D||(G=M.createGain(),G.gain.value=0,G.gain.setTargetAtTime(Le(ze),M.currentTime,j),G.connect(M.destination),e(15,D=M.createOscillator()),e(15,D.type="sine",D),D.start(),D.connect(G))},z=()=>{!D||!G||(G.gain.setTargetAtTime(0,M.currentTime,j),D.stop(M.currentTime+j*2),e(15,D=void 0),G=void 0)};we(z);const H=(n,q,C,P)=>{const U=1-q/P,K=(n/2/C+.5)**10;return ee(He,Je,K)*ee(Qe,We,U)},J=n=>"touches"in n&&n.touches.length?n.touches[0].clientX:n.clientX,Q=n=>"touches"in n&&n.touches.length?n.touches[0].clientY:n.clientY,ce=n=>{if(!("touches"in n)&&n.button!==0)return;R(n),ae(),e(13,b=J(n)),e(14,E=Q(n));const q=O();v.push(q),e(4,v=v.slice())},fe=n=>{!("touches"in n)&&n.button!==0||(R(n),!(!M||!D)&&z())},ue=n=>{!M||!D||(R(n),n.altKey||e(13,b=J(n)),n.shiftKey||e(14,E=Q(n)))},he=()=>{e(4,v=[O()])};function de(n){Me[n?"unshift":"push"](()=>{o=n,e(2,o)})}return s.$$.update=()=>{s.$$.dirty[0]&131072&&e(0,a=i.width),s.$$.dirty[0]&131072&&e(1,h=i.height),s.$$.dirty[0]&7&&o&&a&&h&&c(),s.$$.dirty[0]&24576&&b>=0&&F(b,E),s.$$.dirty[0]&24576&&Y.set({x:b,y:E}),s.$$.dirty[0]&24579&&e(16,l=a?H(b,E,a,h):void 0),s.$$.dirty[0]&98304&&D&&l!==void 0&&D.frequency.setValueAtTime(l,M.currentTime),s.$$.dirty[0]&65536&&e(5,f=l===void 0?"":Math.round(l))},[a,h,o,u,v,f,k,d,Y,ce,fe,ue,he,b,E,D,l,i,de]}class ut extends Pe{constructor(t){super(),qe(this,t,Ze,je,ke,{},null,[-1,-1])}}export{ut as component};
